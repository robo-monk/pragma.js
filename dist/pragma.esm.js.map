{"version":3,"file":"pragma.esm.js","sources":["../src/core/util/log.js","../src/core/actionChain.js","../src/core/util/utilities.js","../src/core/util/dom.js","../src/core/util/parsers.js","../src/core/util/index.js","../src/core/util/tpl.js","../src/core/element.js","../src/core/node.js","../src/core/pragma.js","../src/core/util/script.js","../src/core/util/thread.js","../src/index.js"],"sourcesContent":["import { _deving } from \"./index\"\n\nexport function throwSoft (desc, potential=null, fixes=['rerun the code 10 times'], trigger=null, force=false) {\n  if (!_deving() && !force) return null\n  console.error(`%c ðŸ§¯ pragma.js  %c \\n\n      encountered a soft error ðŸ”« %c \\n\n      \\n${trigger ? `Triggered by: [${trigger.key} ${trigger}]` :``}\n      \\n${desc} %c\\n\n      \\n${ potential!=null ? `Potential ${potential}: \\n\\t${fixes.join(\"\\n\\t\")}` : '' }\n      `, \"font-size:15px\", \"font-size: 12px;\", \"color:whitesmoke\", \"color:white\")\n}\n\nexport function log(){\n  if (!_deving()) return null\n  console.log(...arguments)\n}\n\nexport function suc(){\n  if (!_deving()) return null\n  console.log(`%c ðŸŒ´ [pragma] \\n\n      `, \"font-size:12px; color:#86D787;\", ...arguments, \"\\n\")\n}\n","export default class ActionChain {\n  constructor(self){\n    this.self = self\n    this.actions = new Map()\n\n    //API extension\n    this.delete = this.destroy\n  }\n\n  addWithKey(cb, key=null){\n    key = key || this.actions.size\n    this.actions.set(key, cb)\n    return key\n  }\n\n  add(...cbs){\n    let keys = []\n    for (let cb of cbs){\n      keys.push(this.addWithKey(cb))\n    }\n\n    return keys.length > 1 ? keys : keys[0]\n  }\n\n  forAction(cb){\n    for (let [key, action] of this.actions) {\n      cb(key, action)\n    }\n  }\n\n  exec(...args){\n    this.execAs(this.self, ...args)\n  }\n\n  destroy(...keys){\n    keys.forEach(k => this.actions.delete(k))\n  }\n\n  execAs(self, ...args){\n    this.forAction((key, act) => {\n      let retVal = null\n\n      if (typeof act.bind === 'function'){\n        retVal = act.bind(self)(...args)\n      } else {\n        retVal = act(...args)\n      }\n\n      if (typeof retVal === 'function'){\n        // TODO make this a class\n        \n        let self = {\n          key: key,\n          action: act,\n          replaceWith: cb => {\n            // TODO implement\n          },\n          selfDestruct: () => {\n            this.destroy(key) \n          }\n        }\n\n        retVal(self)\n      }\n    })\n  }\n}\n","import ActionChain from \"../actionChain\"\nimport { html, _e } from \"../../index\"\n\nfunction rk5(){\n return Math.random().toString(36).substring(3, 6) + Math.random().toString(36).substring(5, 8)\n}\nfunction rk8(){ return rk(8)}\n\nfunction rk(l=7) {\n if (l < 5) return rk5()\n return (rk5() + rk(l-5)).substring(0, l)\n}\n\nfunction generateRandomKey(l){\n  return rk(l)\n}\n\nfunction aryDiff(a, b){\n  return a.filter(i => b.indexOf(i)<0)\n}\n\nfunction bench(cb, name){\n  console.time(name)\n  cb()\n  console.timeEnd(name)\n}\n\nfunction objDiff(obj, edit){\n  // TODO add recursive feature\n  for (let [key, value] of Object.entries(edit)){\n    obj[key] = value\n  }\n\n  return obj\n}\n\nconst snake2camel = str => str.replace(/([-_]\\w)/g, g => g[1].toUpperCase()) \n\nfunction _extend(e, proto){\n  Object.setPrototypeOf(e, objDiff(Object.getPrototypeOf(e), proto))\n}\n\nfunction mimic(obj, mimic, props){\n  for (let prop of (props || Object.keys(mimic))){\n    let desc = Object.getOwnPropertyDescriptor(mimic, prop) \n    if (!desc) break\n    Object.defineProperty(obj, prop, desc)\n  }\n}\n\nString.prototype.capitalize = function() {\n  return this.charAt(0).toUpperCase() + this.slice(1)\n}\n\nfunction _newChain(name, obj){\n  let chainName = `${name}Chain`\n  let eventName = `on${name.capitalize()}`\n\n  obj[chainName] = new ActionChain(obj)\n\n  obj[eventName] = function (cb, key) {\n    obj[chainName].addWithKey(cb, key)\n  }\n\n  return {\n      chainName: chainName,\n      eventName: eventName\n  }\n}\n\nfunction createChains(obj, ...chains){\n  for (let chain of chains){\n      _newChain(chain, obj)\n  }\n}\n\nfunction _newEventChain(name, obj){\n  let refs = _newChain(name, obj)\n  let done = `is${name.capitalize()}ed`\n\n  obj[refs.chainName].add(() => {\n    obj[done] = true\n  })\n\n  obj[refs.eventName] = function (cb) {\n    if (obj[done]) return cb(obj)\n    obj[refs.chainName].add(cb)\n  }\n}\n\n// DEPRECATE\nfunction createEventChains(obj, ...chains){\n  for (let chain of chains){\n      _newEventChain(chain, obj)\n  }\n}\n\nfunction addStyles(css, name=`injected-pragma-style`){\n  _e(`style#${name}-${rk5()}`, css).appendTo('head')\n}\n\nfunction overwrite(object, attr, over){\n  let superf = object[attr]\n  object[`_${attr}`] = superf.bind(object)\n  object[attr] = over\n}\n\nfunction redirectTo(href, newTab=false) {\n  history?.pushState({}, document.title)\n  html`<a href=\"${href}\" ${newTab ? `target=\"_blank\"` : ''}</a>`.click()\n}\n\nexport {\n  generateRandomKey,\n  objDiff,\n  aryDiff,\n  _extend,\n  overwrite,\n  createEventChains,\n  createChains,\n  snake2camel,\n  mimic,\n  bench,\n  addStyles,\n  redirectTo,\n  rk, rk5, rk8\n}\n","import { throwSoft, suc } from \"./log\"\nimport { createEventChains } from \"./utilities\"\nimport _e from \"../element\"\n\nconst toHTMLAttr = s => s.toString().replace(/[^a-z0-9]/gi, '-').toLowerCase()\n\nif (!globalThis.pragmaSpace) globalThis.pragmaSpace = {} // initialize Pragma Space # TODO put this somewhere else\ncreateEventChains(globalThis.pragmaSpace, \"docLoad\")\nconst whenDOM = globalThis.pragmaSpace.onDocLoad\n\nfunction _docLoad(){\n  if (globalThis.pragmaSpace.isDocLoaded) return\n\n  suc(\"ðŸ“° document is loaded.\")\n  globalThis.pragmaSpace.docLoadChain.exec()\n}\n\nif (document.readyState === \"complete\"){\n  _docLoad()\n} else {\n  document.addEventListener('readystatechange', () => {\n    if (document.readyState === \"complete\") _docLoad()\n  })\n\n  document.addEventListener('turbolinks:load', () => {\n    suc(\"ðŸš€ TURBOLINKS loaded\")\n    _docLoad()\n  })\n}\n\nvar search = /[#.]/g\n\n// Create a hast element from a simple CSS selector.\nfunction parseQuery(selector, defaultTagName = \"div\") {\n  var value = selector || ''\n  var props = {\n    tag: defaultTagName\n  }\n  var start = 0\n  let subvalue, previous, match\n\n  while (start < value.length) {\n    search.lastIndex = start\n    match = search.exec(value)\n    subvalue = value.slice(start, match ? match.index : value.length)\n    if (subvalue) {\n      if (!previous) {\n        props.tag = subvalue\n      } else if (previous === '#') {\n        props.id = subvalue\n      } else if (props.class) {\n        props.class.push(subvalue)\n      } else {\n        props.class = [subvalue]\n      }\n      start += subvalue.length\n    }\n    if (match) {\n      previous = match[0]\n      start++\n    }\n  }\n  return props\n}\n\nfunction loopThruClassAryAndDo(cary, el, action){\n  if (!(Array.isArray(cary))) return throwSoft(`Could not ${action} class [${cary}] -> [${el}]`)\n  for (let c of cary){\n    let _subary = c.split(\" \")\n    if (_subary.length>1) {\n      loopThruClassAryAndDo(_subary, el, action)\n      //loopThruClassAryTo(_subary, el)\n      continue\n    }\n    el.classList[action](c)\n  }\n}\n\nfunction addClassAryTo(cary, el){ loopThruClassAryAndDo(cary, el, 'add') }\nfunction removeClassAryFrom(cary, el){ loopThruClassAryAndDo(cary, el, 'remove') }\nfunction toggleClassAryOf(cary, el){ loopThruClassAryAndDo(cary, el, 'toggle') }\n\nfunction selectOrCreateDOM(query){\n  query = query.trim()\n  try {\n    let e = document.querySelector(query)\n    if (e) return e\n  } catch {}\n\n  let q = parseQuery(query)\n\n  let el =  document.createElement(q.tag || \"div\")\n  if (q.id) el.id = q.id\n  if (q.class) addClassAryTo(q.class, el)\n\n  return el\n}\n\nfunction fragmentFromString(strHTML) {\n    return document.createRange().createContextualFragment(strHTML);\n}\n\nfunction elementFrom(e){\n  if (e instanceof Element) return e\n  if (typeof e === \"string\"){\n    if (e[0] === \"<\") return fragmentFromString(e)\n    return selectOrCreateDOM(e)\n  }\n\n  return throwSoft(`Could not find/create element from [${e}]`)\n}\n\nfunction fillSVG(svg, color){\n  _e(svg).findAll(\"path\").forEach(path => {\n    const ff = path.attr(\"fill\")\n    if (ff!=\"none\" && ff!=\"transparent\"){\n      path.attr(\"fill\", color)\n    }\n  })\n}\n\nexport {\n  whenDOM,\n  parseQuery,\n  addClassAryTo,\n  removeClassAryFrom,\n  toggleClassAryOf,\n  selectOrCreateDOM,\n  elementFrom,\n  toHTMLAttr,\n  fragmentFromString,\n  fillSVG\n}\n","import { throwSoft } from \"./log\"\nimport { snake2camel } from \"./utilities\"\n\n\nconst apply = {\n  html: ((html, dom) => {\n    dom.innerHTML = html \n  }),\n\n  pcss: ((pcss, dom) => {\n    for (let [key, value] of parse.cssToDict(pcss)){\n      dom.style[snake2camel(key)] = value \n    }\n  })\n}\n\nconst parse = {\n  cssToDict: ((str) => {\n    str = str.replace(/\\n/g, \";\").replace(/:/g, \" \")\n    let cssDict = new Map()\n    for (let style of str.split(\";\")) {\n      if (style.replace(/\\s/g, \"\").length < 2) continue\n      style = style.trim().split(\" \")\n      let key = style[0]\n      style.shift()\n      cssDict.set(key.trim(), style.join(\" \").trim())\n    }\n\n    // check css properties\n    let unsupported = []\n    for (const [key, value] of cssDict.entries()) {\n      if (!CSS.supports(key, value)) unsupported.push(`${key.trim()}: ${value.trim()}`)\n    }\n\n    if (unsupported.length > 0) {\n      throwSoft(`CSS syntax error`, 'typos', unsupported)\n    }\n    return cssDict\n  }),\n\n  css: ((pcss) => {\n    let css = \"\"\n    for (let [key, value] of parse.cssToDict(pcss)) {\n      //console.log(key, value)\n      css += `${key}:${value};`\n    }\n    return css\n  }),\n\n  html: ((html) => {\n    return html\n  })\n}\n\nexport {\n  parse,\n  apply\n}\n","if (!globalThis.pragmaSpace) globalThis.pragmaSpace = {} // initialize Pragma Space # TODO put this somewhere else\nglobalThis.pragmaSpace.dev =  globalThis.pragmaSpace.dev\n    || (typeof process !== \"undefined\" && process.env && process.env.NODE_ENV === 'development')\n\nexport function _deving(){\n  return globalThis.pragmaSpace.dev\n}\n\nexport * from \"./log\"\nexport * from \"./dom\"\nexport * from \"./utilities\"\nexport * from \"./parsers\"\nexport * from \"./tpl\"","import { Pragma, util } from \"../../index\"\n\nconst createTemplate = conf => new Pragma()\n    .run(function () {\n        util.createChains(this, 'config')\n\n        this.config = function(conf){\n            this.configChain.exec(conf)\n            return this\n        }\n        \n        this.onConfig((conf = {}) => {\n            const defaults = ['events', 'chains', 'exports', 'persistentExports']\n            defaults.forEach(attr => {\n                if (!conf[attr]) return\n                this[`_${attr}`] = conf[attr]\n                delete conf[attr]\n            })\n\n            if (this._events) util.createEventChains(this, ...(this._events))\n            if (this._chains) util.createChains(this, ...(this._chains))\n            \n            for (let [attr, val] of Object.entries(conf)) {\n                this[attr] = val\n                this.export(attr)\n            }\n            if (this._exports) this.export(...(this._exports))\n\n        })\n\n        this.export('exports', 'config', 'exportChain', 'configChain', 'onConfig')\n        \n    }, function () {\n        if (typeof conf === 'object') this.config(conf)\n    })\n\n\nexport { createTemplate }\n","// Its like $(\"#id\") of jquery\n\nimport {\n  throwSoft,\n  whenDOM,\n  addClassAryTo,\n  removeClassAryFrom,\n  toggleClassAryOf,\n  elementFrom,\n  apply,\n  createEventChains\n} from \"./util/index\"\n\n\nfunction domify(e){\n  if (e == null || e == undefined) return throwSoft(`Could not find a DOM element for ${e}`)\n  if (e.element) return domify(e.element)\n  let a = elementFrom(e)\n  return a\n}\n\n// function elementify(e){\n//   if (e == null) return document.body\n//   if (e.isPragmaElement === true) return e\n//   return new Element(e)\n// }\n\nfunction convertShadowToLight(e){\n  var l = document.createElement('template')\n  l.appendChild(e.cloneNode(true))\n  return l.firstChild\n}\n\nexport default function _e(query, innerHTML){\n    let element = domify(query)\n    if (!element) return throwSoft(`${query} could not be found/created`)\n\n    if (element.constructor === DocumentFragment){\n      element = convertShadowToLight(element)\n    }\n\n    if (element instanceof Element){\n      element.init()\n      element._render()\n    }\n\n    if (typeof innerHTML === \"string\") element.html(innerHTML)\n    //if (typeof cb === \"function\") cb(element)\n    return element\n  //})\n}\n\nconst elementProto = {\n  init: function(){\n    this.isPragmaElement = true\n    //this.eventChains(\"docLoad\", \"render\")\n    createEventChains(this, \"docLoad\", \"render\")\n    whenDOM(() => this.docLoadChain.exec(this))\n  },\n\n  _render: function(){\n    this.renderChain.exec(this)\n  },\n\n  appendTo: function(where){\n    this.onDocLoad(() => {\n      this._parentElement = domify(where)\n      this._parentElement.appendChild(this)\n      this._render()\n    })\n    return this\n  },\n\n  prependTo: function(where){\n    this.onDocLoad(() => {\n      this._parentElement = domify(where)\n      this._parentElement.prepend(this)\n      this._render()\n    })\n    return this\n  },\n\n  append: function(...elements){\n    this.onRender(() => {\n      for (let e of elements){\n        let d = domify(e)\n        this.appendChild(d)  \n      }\n    })\n    return this\n  },\n\n  destroy: function(){\n    this.onRender(()=> {\n      // console.log(`destroy ${this}`, this)\n      if (this.parentElement) this.parentElement.removeChild(this)\n    })\n  },\n\n  css: function(styles){\n    this.onRender(() => {\n      apply.pcss(styles, this)\n    })\n    return this\n  },\n\n  setText: function(text){\n    if (!text) return this.text\n    this.onRender(() => {\n      this.textContent = text \n    })\n    return this\n  },\n  html: function(inner){\n    if (inner == undefined) return this.innerHTML\n    this.onRender(() => {\n      apply.html(inner, this)\n    })\n    return this\n  },\n\n  setId: function(id){\n    this.id = id\n    return this\n  },\n\n  setData: function(obj){\n    for (let [key, val] of Object.entries(obj)){\n      this.dataset[key] = val\n    }\n    return this\n  },\n\n  getData: function(key){\n    return this.dataset[key] \n  },\n\n  addClass: function(...classes){\n    addClassAryTo(classes, this)\n    return this\n  },\n\n  removeClass: function(...classes){\n    removeClassAryFrom(classes, this)\n    return this\n  },\n\n  toggleClass: function(...classes){\n    toggleClassAryOf(classes, this) \n    return this\n  },\n\n  listenTo: function(...args){\n    this.onRender(() => {\n      this.addEventListener(...args)\n    })\n    return this\n  },\n\n  clone: function(deep=true) {\n    return this.cloneNode(deep)\n  },\n\n  attr: function(a, val=null){\n    if (typeof a === 'string'){\n      if (val === null) return this.getAttribute(a)\n      const key = a\n      a = {}\n      a[key] = val\n    }\n\n    for (let [attr, val] of Object.entries(a)){\n      this.setAttribute(attr, val)\n    }\n\n    return this\n  },\n\n  find: function(){\n    return _e(this.query(...arguments))\n  },\n\n  define: function(elements) {\n    // let map = {}\n    this.setData(elements)\n    for (let [key, attr] of Object.entries(elements)) {\n      this[key] = this.id ? `#${this.id}>${attr}` : attr\n      // this.prototype[key] = this.find(attr)\n      // let map = d\n      // Object.defineProperty(this, key, {\n        // value: this.find(attr),\n        // configurable: true\n      // })\n    }\n\n    // this.elements = map\n    // console.log(this.elements)\n    return this\n  },\n\n\n\n  findAll: function(query){\n    return Array.from(this.queryAll(query)).map(c => _e(c))\n  },\n\n  query: function(){\n    return this.querySelector(...arguments)\n  },\n\n  queryAll: function(query){\n    return this.querySelectorAll(query)\n  },\n  \n  hide: function(){\n    this.style.display = 'none'\n    return this\n  },\n  \n  show: function(){\n    this.style.display = ''\n    return this\n  },\n\n// DEPRECATE\n  deepQueryAll: function(query){\n    let hits = Array.from(this.queryAll(query))\n    for (let child of this.children){\n      hits = hits.concat(child.deepQueryAll(query))\n    }\n    return hits\n  },\n// DEPRECATE\n  deepFindAll: function(query){\n    return this.deepQueryAll(query).map(c => _e(c))\n  },\n\n  rect: function rect(){\n    return typeof this.getBoundingClientRect === \"function\" ?\n            this.getBoundingClientRect() : {}\n  },\n\n  offset: function offset(obj){\n\n    if (obj){\n      const cssAttrs = [ 'width', 'height', 'left', 'right', 'top', 'bottom']\n      cssAttrs.forEach(attr => {\n        if (attr in obj) this.style[attr] = obj[attr] + 'px'\n      })\n    }\n\n    var rect = this.rect()\n    return {\n      top: rect.top + window.scrollY,\n      left: rect.left + window.scrollX\n    }\n  },\n\n  x: function(relative_width){\n    return this.left + this.width/2 - relative_width/2\n  }\n}\n\nconst elementGetters = {\n  top:  function(){\n    return this.offset().top\n  },\n  left: function(){\n    return this.offset().left\n  },\n  width: function(){\n    return this.rect().width\n  },\n  height: function(){\n    return this.rect().height\n  },\n  text: function(){\n    return this.textContent\n  },\n  classArray: function(){\n    return Array.from(this.classList)\n  },\n  childrenArray: function(){\n    return Array.from(this.children)\n  }\n}\n\nfor (let [key, val] of Object.entries(elementProto)){\n  Element.prototype[key] = val\n}\n\nfor (let [key, val] of Object.entries(elementGetters)){\n  Object.defineProperty(Element.prototype, key, {\n    get: val,\n    configurable: true\n  })\n}\n\n// extend element instead of this weird ass thing\n","// recursively connected with other nodes\nimport { throwSoft, rk8, rk5 } from \"./util/index\"\n\nexport default class Node {\n  constructor(key) {\n    this._childMap = new Map()\n    this.key = typeof key === 'string' ? key : rk8()\n    // API\n    this.containsKey = this.childMap.has\n  }\n  set childMap(n){\n    for (let [key, child] of n){\n      if (child instanceof Node){\n        this.add(child)\n      }\n    }\n  }\n  get childMap(){\n    return this._childMap\n  }\n\n  get kidsum() { return this.childMap.size }\n  get hasKids() { return this.kidsum > 0 }\n  get shape() { return this.shapePrefix() }\n\n  get master() {\n    if (this.parent == null || this.parent.parent == null) return this.parent\n    return this.parent.master\n  }\n\n  get children() {\n    return Array.from(this.childMap.values())\n  }\n\n  get depthKey() {\n    if (this.parent) {\n      return this.parent.depthKey + \"<~<\" + this.key\n    }\n    return this.key\n  }\n\n  get allChildren() {\n    if (!this.hasKids) return null\n    let childs = this.children\n    for (let child of childs) {\n      let descs = child.allChildren\n      if (descs) childs = childs.concat(descs)\n    }\n    return childs\n  }\n\n  get(key){\n    return this.childMap.get(key)\n  }\n\n  find(key) {\n    // key = key.toString()\n    // recursively find a key\n    // return false\n    // console.log('trying to find', key)\n    // console.log(this.childMap)\n    if (this.childMap.has(key)) return this.childMap.get(key)\n    for (let value of this.childMap.values()) {\n      let v\n      try { v = value.find(key) } catch {} // if the value \n        // is typeof element and key is not valid selector..\n      if (v) return v\n    }\n  }\n\n  adopt(...children){\n      for (let child of children){\n        this.add(child)\n      }\n      return this\n  }\n\n  add(node, replace=false) {\n    if (!node) return throwSoft(`Could not add [${node}] to [${this.id}]`)\n    if (!replace && this.childMap.has(node.key)) {\n      node.key = `${node.key}<${rk5()}`\n      return this.add(node)\n    }\n    node.parent = this\n    this.childMap.set(node.key, node)\n    // this.children.push(spragma)\n  }\n\n  delete(key){return this.remove(key)}\n  remove(key){\n    let node = this.childMap.get(key)\n    if (node) this.childMap.delete(key)\n  }\n\n  shapePrefix(prefix = \"\") {\n    let shape = `${prefix}| ${this.type} - ${this.key} \\n`\n    if (this.hasKids) {\n      prefix += \"| \"\n      for (let child of this.children) {\n        shape += child.shapePrefix(prefix)\n      }\n    }\n    return shape\n  }\n}\n","import Node from \"./node\"\nimport _e from \"./element\"\nimport ActionChain from \"./actionChain\"\nimport { generateRandomKey, toHTMLAttr, createEventChains, suc, log, throwSoft } from \"./util/index\"\nimport { util } from \"..\"\n\n// DEPRECATE\nconst _parseMap = {\n\n  parent: (self, parent) => {\n    self.parent = parent\n  },\n\n  value: (self, v) => {\n    self.value = v\n  },\n\n  key: (self, key) => {\n    self.key = key\n  },\n\n  class: (self, className) => {\n    self._class = className\n  },\n\n  element: (self, element) => {\n    if (!(element instanceof Element)) return throwSoft(`Could not add ${element} as the element of [${self}]`)\n    self.element = element\n  },\n\n  children: (self, children) => {\n    if (children.constructor == Array) return self.buildAry(children)\n    self.build(children)\n  },\n\n  childTemplate: (self, temp) => {\n\n  }\n}\n\nfunction parseMap(map, obj) {\n  let _notParsed = new Map()\n\n  for (let [key, val] of Object.entries(map)){\n    if (_parseMap.hasOwnProperty(key)){\n      _parseMap[key](obj, val)\n      continue\n    }\n    _notParsed.set(key, val)\n  }\n\n  // add listener callbacks\n  if (obj.element) {\n    obj.element.whenInDOM((self) => {\n      for (let [key, val] of _notParsed) {\n        key = key.toLowerCase()\n        if (key.includes(\"on\")){\n          let event = key.split(\"on\")[1].trim()\n          self.listenTo(event, () => {\n            obj.action(val)\n          })\n        }\n      }\n    })\n  }\n}\n\n\nfunction _isRangeBounded(range){\n  return range && range.min != undefined && range.max != undefined\n}\nfunction _retValObj(val, set){\n  return {\n    val: val,\n    set: set\n  }\n}\nfunction _rangeBoundVal(v, range){\n  v = range.min ? Math.max(range.min, v) : v\n  v = range.max ? Math.min(range.max, v) : v\n  // console.log(v)\n  return v\n  // r ? Math.max(r[0], Math.min(v, r[1])) : v\n}\n\nfunction _loopBoundVal(v, range){\n  if (!(_isRangeBounded(range)))\n    return throwSoft(`Could not loop value, since range (${JSON.stringify(range)}) is unbounded`)\n\n  if (v == undefined) v = range.min\n\n  v = v > range.max ? range.min : v\n  v = v < range.min ? range.max : v\n  return v\n}\n\nfunction _processValue2(v, range, loop) {\n  if (loop) return _retValObj(_loopBoundVal(v, loop), true)\n  if (range) {\n    let r = _rangeBoundVal(v, range)\n    return _retValObj(r, r===v)\n  }\n\n  return _retValObj(v, true)\n}\n\nfunction _processValue(v, range, _loop) {\n  if (!range) return _retValObj(v, true)\n  if (_loop) return _retValObj(_loopBoundVal(v, range), true)\n  let r = _rangeBoundVal(v, range)\n  return _retValObj(r, r==v)\n}\n\nexport default class Pragma extends Node {\n  constructor(map, parent){\n    super()\n    createEventChains(this, 'export')\n\n    this.actionChain = new ActionChain()\n    this._events = new Map()\n\n    // console.log(\"-------------\")\n    if (typeof map === \"object\"){\n      parseMap(map, this)\n    } else {\n      this.key = map\n    }\n\n    if (!this.element) this.as()\n\n    this.init()\n  }\n\n  init(){ return this }\n\n  listenTo(event, action){\n    this.element.listenTo(event, action.bind(this))\n    return this\n  }\n\n  // eventful\n\n  _createEvent(event) {\n    let chain = new ActionChain(this)\n    this._events.set(event, chain)\n    return chain\n  }\n\n  createEvent(eventTitle, ...cbs){\n    this._createEvent(eventTitle) \n    if (cbs.length > 0) this.on(eventTitle, cbs)\n    return this\n  }\n\n  createEvents(...events){\n    events.forEach(event => this._createEvent(event))\n    return this\n  }\n\n\n  _getOrCreateEvent(name) {\n    return this._events.get(name) || this._createEvent(name)\n  }\n\n  _addToEventChain(name, ...cbs){\n    let chain = this._getOrCreateEvent(name) \n    if (chain){\n      let keys = chain.add(...cbs)\n      this._events.set(name, chain)\n      return keys\n    }\n    return null\n  }\n\n  triggerEvent(eventName, ...args){\n    // make this async and paralell\n    this._getOrCreateEvent(eventName).execAs(this, ...args)\n    return this \n  }\n\n  triggerEvents(eventAry, ...args){\n    eventAry.forEach(event => this.triggerEvent(event, ...args))\n    return this\n  }\n\n  _on(event, ...cbs){\n    let keys = this._addToEventChain(event, ...cbs)\n    return keys\n  }\n\n  on(){\n    this._on(...arguments)\n    return this\n  }\n\n  _onNext(event, cb){\n    let cbOnce = function(){\n      cb(...arguments) \n      return thisCallback => {\n        thisCallback.selfDestruct() \n      }\n    }\n    this._on(event, cbOnce)\n  }\n\n  onNext(){\n    this._onNext(...arguments)\n    return this\n  }\n\n  createWires(...wireNames) { wireNames.forEach(wire => this.createWire(wire) ); return this }\n\n  createWire(wireName, initValue){\n\n    let events = {\n      change: `${wireName}Change`,\n      set: `${wireName}Set`\n    }\n\n    this.createEvents(events.change, events.set)\n\n    Object.defineProperty(this, wireName, {\n      set: newValue => {\n        let pv = _processValue2(newValue, this[`_${wireName}Range`], this[`_${wireName}Loop`])\n        const oldValue = this[`_${wireName}`]\n        if (pv.set && (pv.val !== oldValue)) {\n          this[`_${wireName}`] = pv.val\n          this.triggerEvent(events.change, pv.val, oldValue)\n        }\n\n        this.triggerEvent(events.set, newValue, oldValue)\n      },\n      get: () => {\n        return this[`_${wireName}`]\n      }\n    })\n\n    /// DEPRECATE TOO SLOW FOR THIS SHIT\n    this[`set${wireName.capitalize()}`] = value => {\n      this[`${wireName}`] = value\n      return this\n    }\n\n    this[`set${wireName.capitalize()}Silently`] = value => {\n      this[`_${wireName}`] = value\n      return this\n    }\n\n    this[`set${wireName.capitalize()}Loop`] = (min, max) => {\n      this[`_${wireName}Loop`] = { min: min, max: max }\n      return this\n    }\n\n    this[`set${wireName.capitalize()}Range`] = (min, max) => {\n      this[`_${wireName}Range`] = { min: min, max: max }\n      return this\n    }\n\n    if (initValue !== undefined) this[`_${wireName}`] = initValue\n    return this\n  }\n\n  get _e(){ return this.element }\n  setElement(e, inheritId=true){\n    this.elementDOM = e\n    if (inheritId && this.element.id){\n      this.id = this.element.id\n    }\n\n    return this\n  }\n\n  get element(){ return this.elementDOM }\n  set element(n) {\n    this.setElement(n)\n    // TODO check if element is of type elememtn blah blha\n    // log(\">> SETTING THIS DOM ELEMENT\", n, this.id)\n\n\n    // this.id = this.element.id || this.id\n  }\n\n// -------------------- VALUE THINGS\n\n  setRange(min=null, max=null){\n    this.range = this.range || {}\n    this.range.min = min === null ? this.range.min : min\n    this.range.max = max === null ? this.range.max : max\n    return this\n  }\n\n  breakLoop() { this._loopVal = false; return this }\n  setLoop(min, max){\n    this.setRange(min, max)\n    this._loopVal = true\n    return this\n  }\n\n  get dv(){\n    return this.v - this._lv\n  }\n  get value(){\n    return this.v\n  }\n\n  setValue(n) { this.value = n; return this }\n\n  set value(n) {\n    let pv = _processValue(n, this.range, this._loopVal)\n\n    if (pv.set) {\n      this._lv = this.v\n      this.v = pv.val\n      this.exec()\n    }\n  }\n\n\n//  -------------------------------\n\n  exec() {\n    this.actionChain.execAs(this, ...arguments)\n    return this\n  }\n\n  setKey(key) { this.key = key; return this }\n  set key(key){\n    // console.log('setting key to ', key)\n    this._KEY = key == null ? generateRandomKey() : key\n  }\n\n  get key() { return this._KEY }\n\n  set id(n) {\n    // console.log('setting key to from id ', n)\n    // this.key = n\n    if (this.element) this.element.id = this.id\n  }\n\n  get id() {\n    return toHTMLAttr(this.key)\n  }\n\n  buildAry(aryOfMaps){\n    for (let map of aryOfMaps){\n      this.add(new Pragma(map, this))\n    }\n    return this\n  }\n\n  build(...maps) {\n    return this.buildAry(maps)\n  }\n\n  // FOR HTML DOM\n  as(query=null, innerHTML){\n    query = query || `div#${this.id}.pragma`\n    // this.element = _e(query, innerHTML)\n    this.setElement(_e(query, innerHTML), false)\n    return this\n  }\n\n  asClone(query, inner) {\n    this.as(_e(query).clone(), inner)\n    return this\n  }\n\n  // FOR TEMPLATES\n  addExport(exp){\n    this.exports = this.exports || new Set()\n    this.exports.add(exp)\n  }\n\n  export(...attrs){\n    for (let a of attrs) {\n      this.addExport(a)\n    }\n  }\n\n  import(...pragmas){\n    let exportChain = new ActionChain()\n\n    for (let pragma of pragmas){\n      if (typeof pragma === 'function'){\n        pragma = pragma()\n      }\n      \n      if (pragma.exports){\n        // if ('exportChain' in pragma.exports)\n        util.mimic(this, pragma, pragma.exports)\n      }\n\n      if (pragma.exportChain){\n        exportChain.add(_ => {\n          pragma.exportChain.exec(this)\n        })  \n      }\n    }\n    \n    exportChain.exec()\n    return this\n  }\n\n  // TODO DEPRECATE\n  from(pragma){\n    if (pragma.exports){\n      util.mimic(this, pragma, pragma.exports)\n      //for (let attr of pragma.exports){\n        //// this[attr] = pragma[attr]\n        //let desc = Object.getOwnPropertyDescriptor(pragma, attr) \n        //if (!desc) break\n\n        //Object.defineProperty(this, attr, desc)\n      //}\n    }\n\n    if (pragma.exportChain) pragma.exportChain.exec(this)\n    return this\n  }\n\n  wireTo(pragma){\n    let self = this\n    pragma.do(function(){\n      // console.log(this)\n      // console.log(p.value)\n      // this.value = pragma.value\n      self.value = this.value\n    })\n    return this\n  }\n\n  // ADD SCRIPT TO RUN WHEN VALUE CHANGES\n  do(){\n    this.actionChain.add(...arguments)\n    return this\n  }\n\n\n  // EXTEND\n  extend(attr, newer){\n    util.overwrite(this, attr, newer)\n    return this\n  }\n\n  // define functions like\n  // pragma.define(\n  //   function test() {\n  //     console.log('yeet')\n  //   }\n  // ).run(function() {\n  //   this.test() // #=> yeet\n  // })\n  // define(...defs) {\n  //   for (let def of defs) {\n  //     if (!def.name) return console.error(`could not define, no name passed`, def)\n  //     this[def.name] = def\n  //   }\n  //   return this\n  // }\n\n  define({...defs}) {\n    for (let [key, fn] of Object.entries(defs)) {\n      if (!key) return console.error(`could not define, no name passed`, fn)\n      if (typeof fn === 'function') {\n        this[key] = fn\n      } else if (typeof fn === 'string') {\n        this[key] = this.element.find(fn)\n      } else {\n        console.error('could not define', key)\n      }\n    }\n    return this\n  }\n  // RUN SCRIPTS WITH THIS SCOPE\n\n\n  run(...scripts){\n    let sample = scripts[0]\n    if (typeof sample === 'function'){\n      this._runAry(scripts)\n    } else if (typeof sample === 'object'){\n      this._runAry(Object.values(sample))\n    } else {\n      throwSoft(`Could not run [${scripts}] as [${this}]`)\n    }\n    return this\n  }\n\n  _runAry(scripts){\n    for (let script of scripts){\n      this.runAs(script)\n    }\n  }\n\n  runAs(script){\n    return script.bind(this)()\n  }\n  \n  containAry(childs, action='append'){\n    for (let child of childs) {\n      super.add(child)\n\n      if (child.isRendered){\n        throwSoft(`[${child}] is already appended`)\n      }else{\n        this.element[action](child)\n      }\n      \n    }\n    return this\n  }\n\n  contain(...childs){\n    return this.containAry(childs)\n  }\n\n  containFirst(...childs){\n    // TODO FIX \n    return this.containAry(childs.reverse(), 'prepend')\n  }\n\n  // deprecate\n  pragmatize(){\n    this.element.appendTo(this.parent ? this.parent.element || \"body\" : \"body\")\n    return this\n  }\n\n  pragmatizeAt(query){\n    this.element.appendTo(query)\n    return this\n  }\n\n  renderTo(element) {\n    _e(element).html(\"\").append(this.element)\n    this.triggerEvent('render')\n    return this\n  }\n\n\n  addListeners(listeners){\n    for (let [ev, action] of Object.entries(listeners)){\n      this.on(ev).do(action)\n    }\n    return this\n  }\n}\n\n\nconst _hostElementAttrs = [\n  \"html\",\n  \"css\",\n  \"addClass\",\n  \"removeClass\",\n  \"toggleClass\",\n  \"setId\",\n  'append',\n  'prepend',\n  'appendTo',\n  'prependTo',\n  'setData'\n]\n\nfor (let a of _hostElementAttrs) {\n Pragma.prototype[a] = function() {\n    this.element[a](...arguments)\n    return this\n  }\n}\n\nconst _adoptElementAttrs = [\n  'getData'\n]\n\nfor (let a of _adoptElementAttrs) {\n Pragma.prototype[a] = function() {\n    return this.element[a](...arguments)\n  }\n}\n\nconst _adoptGetters = [\n  // html things\n  // \"text\",\n  \"offset\", \"text\",\n  'top', 'left', 'width', 'height', 'x',\n  'classArray'\n]\n\nfor (let a of _adoptGetters) {\n  Object.defineProperty(Pragma.prototype, a, {\n    get: function() {\n      return this.element[a]\n    }\n  })\n}\n\n\n// Mousetrap integration TODO improve this\nif (!globalThis.pragmaSpace) globalThis.pragmaSpace = {}\nglobalThis.pragmaSpace.integrateMousetrap = function(trap){\n  if (typeof trap === 'function') {\n   Pragma.prototype.bind = function(key, f, on=undefined){\n     let self = this\n      trap.bind(key, function(){\n        return self.runAs(f)\n      }, on)\n      return this\n   }\n\n   globalThis.pragmaSpace.mousetrapIntegration = true\n   suc('Mousetrap configuration detected! Extended Pragmas to support .bind() method!')\n }\n}\n\ntry {\n  globalThis.pragmaSpace.integrateMousetrap(Mousetrap)\n} catch (e) {\n  log(`Tried to integrate extensions, but failed. To disable,\n  this attempt: globalThis.pragmaSpace.integrate3rdParties = false`)\n}\n\n // Pragma.prototype[a] = function() {\n //    this.element[a](...arguments)\n //  }\n/*\n *pragmaMap = {\n *  id: \"\",\n *  class: \"\",\n *  value: 0,\n *  elements: [],\n *  element: \"\" / dom,\n *  onSet: () => {\n *\n *  },\n *  onClick: () => {\n *\n *  }\n *}\n */\n","import { Pragma, _e } from \"../../index\"\nimport { rk8 } from \"./index\"\n\nexport class Script extends Pragma {\n\n  static load(url, name=rk8()) {\n    console.time(`${name} load`)\n    return new Promise (resolve => {\n      _e(`script#${name}-loader crossorigin`).appendTo('head').listenTo('load', function(){\n        resolve()\n        console.timeEnd(`${name} load`)\n      })\n      .attr('src', url)\n    })\n  }\n\n}\n\n\n","export function _thread(cb) {\n  let code = `\n    onmessage = e => postMessage(JSON.stringify((${cb.toString()})(e.data))) \n  `  \n  var blob = new Blob([code], {\n    type: \"application/javascript\"\n  })\n\n  var worker = new Worker(URL.createObjectURL(blob))\n\n  return function(){\n      worker.postMessage(arguments)\n    return new Promise(resolve=> {\n      worker.addEventListener('message', m => resolve(JSON.parse(m.data)))\n    })\n  }\n}\n\n/*\n *\n usage:\n \n     const threadedFunction = _thread(data => {\n        return 'your palms are ' + data\n     })\n \n    threadedFunction(\"sweaty\").then(d => console.log('heee', d))\n*/\n    \n\nexport function _runAsync(cb) {\n  return new Promise(r => r(cb()))\n}\n\nexport function runAsync(...cbs) {\n  return _runAsync(() => {\n    for (let cb of cbs) {\n        _runAsync(cb)\n    }\n  })\n}\n","import _e from \"./core/element\"\nimport Pragma from \"./core/pragma\"\nimport ActionChain from \"./core/actionChain\"\n\nexport { _e, Pragma, ActionChain }\nexport { Script } from \"./core/util/script\"\n\n// API layer\n\nconst Ï€ = (query, opt) => new Pragma(query, opt)\nconst _p = Ï€\n//const _e = Îµ\n\nexport { Ï€, _p }\n\nexport * as util from \"./core/util/index\"\n\nexport { _thread, runAsync, _runAsync } from \"./core/util/thread\"\n\n\n// function html(){\n\nexport function html(strings, ...values) {\n  let _html = values.reduce((finalString, value, index) => {\n    return `${finalString}${value}${strings[index + 1]}`\n  }, strings[0])\n\n  return _e(_html.trim())\n}\n\nexport function block(strings, ...values) {\n  let _html = html(strings, ...values) \n  return _p().as(_html)\n}\n\n\nconst exported = [ '_e', '_p', 'Pragma', 'util', 'block', 'html' ]\n\nexport function globalify() {\n  let pragmaModule = (globalThis || window)[\"pragma\"]\n  if (pragmaModule && pragmaModule !== \"undefined\" && pragmaModule.__esModule) {\n    for (let func of exported) {\n      globalThis[func] = pragmaModule[func]\n    }\n  } else {\n    console.error(\"[pragmajs] seems to be missing...\")\n  }\n}"],"names":["throwSoft","desc","potential","fixes","trigger","force","_deving","console","error","key","join","log","arguments","suc","ActionChain","[object Object]","self","this","actions","Map","delete","destroy","cb","size","set","cbs","keys","push","addWithKey","length","action","args","execAs","forEach","k","forAction","act","retVal","bind","replaceWith","selfDestruct","rk5","Math","random","toString","substring","rk8","rk","l","generateRandomKey","objDiff","obj","edit","value","Object","entries","snake2camel","str","replace","g","toUpperCase","_newChain","name","chainName","eventName","capitalize","createChains","chains","chain","_newEventChain","refs","done","add","createEventChains","String","prototype","charAt","slice","toHTMLAttr","s","toLowerCase","globalThis","pragmaSpace","whenDOM","onDocLoad","_docLoad","isDocLoaded","docLoadChain","exec","document","readyState","addEventListener","search","parseQuery","selector","defaultTagName","props","tag","start","subvalue","previous","match","lastIndex","index","id","class","loopThruClassAryAndDo","cary","el","Array","isArray","c","_subary","split","classList","addClassAryTo","removeClassAryFrom","toggleClassAryOf","selectOrCreateDOM","query","trim","e","querySelector","q","createElement","fragmentFromString","strHTML","createRange","createContextualFragment","elementFrom","Element","apply","html","dom","innerHTML","pcss","parse","cssToDict","style","cssDict","shift","unsupported","CSS","supports","css","dev","process","env","NODE_ENV","svg","color","_e","findAll","path","ff","attr","a","b","filter","i","indexOf","proto","setPrototypeOf","getPrototypeOf","object","over","superf","mimic","prop","getOwnPropertyDescriptor","defineProperty","time","timeEnd","appendTo","href","newTab","history","pushState","title","click","conf","Pragma","run","util.createChains","config","configChain","onConfig","_events","util.createEventChains","_chains","val","export","_exports","domify","undefined","element","constructor","DocumentFragment","appendChild","cloneNode","firstChild","init","_render","elementProto","isPragmaElement","renderChain","where","_parentElement","prependTo","prepend","append","elements","onRender","d","parentElement","removeChild","styles","setText","text","textContent","inner","setId","setData","dataset","getData","addClass","classes","removeClass","toggleClass","listenTo","clone","deep","getAttribute","setAttribute","find","define","from","queryAll","map","querySelectorAll","hide","display","show","deepQueryAll","hits","child","children","concat","deepFindAll","rect","getBoundingClientRect","offset","top","window","scrollY","left","scrollX","x","relative_width","width","elementGetters","height","classArray","childrenArray","get","configurable","Node","_childMap","containsKey","childMap","has","n","kidsum","hasKids","shape","shapePrefix","master","parent","values","depthKey","allChildren","childs","descs","v","node","remove","prefix","type","_parseMap","className","_class","buildAry","build","childTemplate","temp","_retValObj","_rangeBoundVal","range","min","max","_loopBoundVal","JSON","stringify","super","actionChain","_notParsed","hasOwnProperty","whenInDOM","includes","event","parseMap","as","eventTitle","_createEvent","on","events","_getOrCreateEvent","eventAry","triggerEvent","_addToEventChain","_on","thisCallback","_onNext","wireNames","wire","createWire","wireName","initValue","change","createEvents","newValue","pv","loop","r","_processValue2","oldValue","inheritId","elementDOM","setElement","_loopVal","setRange","dv","_lv","_loop","_processValue","_KEY","aryOfMaps","maps","exp","exports","Set","attrs","addExport","pragmas","exportChain","pragma","util","_","do","newer","overwrite","defs","fn","scripts","sample","_runAry","script","runAs","isRendered","containAry","reverse","listeners","ev","_hostElementAttrs","_adoptElementAttrs","_adoptGetters","integrateMousetrap","trap","f","mousetrapIntegration","Mousetrap","Script","url","Promise","resolve","_thread","code","blob","Blob","worker","Worker","URL","createObjectURL","postMessage","m","data","_runAsync","runAsync","Ï€","opt","_p","strings","reduce","finalString","block","_html","exported","globalify","pragmaModule","__esModule","func"],"mappings":"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"}