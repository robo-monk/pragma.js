import t from"jquery";import e from"tippy.js";import i from"mousetrap";function n(t,e){for(let i=0;i<t.length;i+=1)e(t[i])}const s=(t,e=null,i=["rerun the code 10 times"],n=null)=>{console.error(`%c ðŸ§¯ pragma.js  %c \n\n      encountered a soft error ðŸ”« %c \n\n      \n${n?`Triggered by: [${n.key} ${n}]`:""}\n      \n${t} %c\n\n      \n${null!=e?`Potential ${e}: \n\t${i.join("\n\t")}`:""}\n      `,"font-size:15px","font-size: 12px;","color:whitesmoke","color:white")},r={cssToDict:t=>{t=t.replaceAll("\n",";").replaceAll(":"," ");let e=new Map;for(let i of t.split(";")){if(i.replace(/\s/g,"").length<2)continue;i=i.trim().split(" ");let t=i[0];i.shift(),e.set(t.trim(),i.join(" ").trim())}let i=[];for(const[t,n]of e.entries())CSS.supports(t,n)||i.push(`${t.trim()}: ${n.trim()}`);return i.length>0&&s("CSS syntax error","typos",i),e},css:t=>{let e="";for(let[i,n]of r.cssToDict(t))e+=`${i}:${n};`;return e}};class a{constructor(e=null,i={},n){this.element=t(e),this.generate_key(n),this.childMap=new Map,this.setup_listeners(i),IntersectionObserver.default={fill:"shit"}}throw(t,e,i=[]){s(t,e,i,this)}get children(){return Array.from(this.childMap.values())}generate_key(t){this.key=null!=t?t:btoa(Math.random()).substr(10,5)}find(t){if(this.childMap.has(t))return this.childMap.get(t);for(let[e,i]of this.childMap){let e=i.find(t);if(e)return e}}add(t){if(this.childMap.has(t.key))return t.key=t.key+"~",this.add(t);t.parent=this,this.childMap.set(t.key,t)}get kidsum(){return this.childMap.size}get hasKids(){return this.kidsum>0}listen(t){return this.setup_listeners(t),this}setup_listeners(t){Object.entries(t).forEach(([t,e])=>{this.element.on(t,()=>e())})}click(){}text(){return this.element.text()}offset(){return this.element.offset()}left(){return this.offset().left}top(){return this.offset().top}height(){return this.element.height()}width(){return this.element.width()}x(t){return this.left()+this.width()/2-t/2}css(t){return this.element&&this.element.css(Object.fromEntries(r.cssToDict(t))),this}get _isPragma(){return!0}}const l={custom:(t,e=0,i,n)=>new C({key:t,value:e,set:(t,e,i)=>{if(n)return n(t,i,e)}}).as(`<${i}>${e}</${i}>`,t+"-monitor"),simple:(t,e=0,i="p",n=null)=>l.custom(t,e,i,(t,e,i)=>{if(e.element.text(t),n)return n(t,e,i)})},h={action:(t,e,i,n)=>{let s=new C({key:t,icon:e,type:"button",click:i});return n&&s.setTippy(n),s},controls:(t,e,i,n,s)=>{let r=h.action(t+"+",s["+"]||"+",(t,e)=>{e.parent.value+=i}),a=h.action(t+"-",s["-"]||"-",(t,e)=>{e.parent.value+=-i});return l.simple(t,e,"div").prepend(r).append(a)}},o=(t,e,i,n,s,r)=>new C(u({key:t,value:e,icon:i,set:n,click:s,variants:r})),u=t=>({key:t.key,value:t.value,type:"choice",element_template:(e,i)=>((e,n,s,r)=>({key:e,type:"button",icon:s,value:n,click:(e,n)=>{(e=>{((t,e,i)=>{t.find(i.key).value=e})(e,i,t)})(e)}}))(t.key,i,t.icon(e,i)),set:(e,i)=>{i&&i.find(t.key)&&(t=>{for(let e of t.children)e.element.removeClass("pragma-active");t.children[t.value].element.addClass("pragma-active")})(i.find(t.key)),t.set(e,i,t.key)},variants:t.variants}),d={simple:(t,e=0,i=420,n)=>{n=n||(e+i)/2;let s=m(t).as(`<input type='range' min=${e} max=${i} value=${n}></input>`).setRange(e,i);return s.element.on("input",()=>{s.value=parseInt(s.element[0].value)}),s},value:(t,e,i,n=0,s)=>{let r=l.simple(t+"_monitor",n,"div"),a=d.simple(t+"_slider",e,i,n),h=m(t).contain(a,r).setRange(e,i);return a.addToChain(t=>{t=parseInt(t),h.value=t}),h.addToChain(t=>{a.element[0].value=t.toString()}),h.chain(r)}},c={attr:(t,e,i,n,s=0)=>new C(u({key:t,value:s,icon:(t,e)=>{let i=n(t,e);return`<div class="${i.type}" style='width:25px;height:25px;border-radius:25px;${i.css}'>${i.html}</div>`},set:(t,n,s)=>{i&&i(e[t],n,s)},variants:e})).setRange(0,e.length-1).setLoop(),color:(t,e,i,n=0)=>c.attr(t,e,i,(t,e)=>({css:`background:${t}`,html:""}),n),font:(t,e,i,n=0)=>c.attr(t,e,i,(t,e)=>({css:`font-family:${t}`,html:"Aa"}),n)},p=(t,e,i,n=null,s=null)=>({key:t,type:e,value:s,icon:i,elements:n}),m=(t,e,i,n="composer")=>new C(t instanceof Object?t:p(t,n,e,i)),f=(t,e,i,n,s="value")=>new C(p(t,s,i,n));class g{constructor(t){this.where=t}pragmatize(){n(arguments,t=>{t.pragmatize(this.where)})}}const y=t=>{return(e=t)&&"object"==typeof e&&e._isPragma?new g(t.element):new g($(t));var e},v=(t,e)=>(t.pragmatize(e),t),k=(t,e)=>(t.contain(e),t),b=(t,e)=>t.host(e),w=(t,e=[],i=((t,e)=>console.table(t)))=>{let n=m(t.key+"Bridge");return n.do((t,s,r)=>{e.includes(r.key)&&(n.actualValue=function(t){let i={};for(let s of e){let e=t.find(s);e?i[s]=e.value:console.warn(`pragmajs > could not find ${s} in ${t.key}\n        when bridgin through ${n.key}`)}return i}(s),function(t){i(n.value,t)}(r))}),t.chain(n),n.set=e=>{for(let[i,n]of Object.entries(e))t.find(i).value=n},n};class C extends a{constructor(t,e=null){super(),this.actualValue=null,t instanceof Object?(this.build(t),this.parent=e):this.key=t,this.log_txt="",this.addToChain((t,e,i=this)=>{this.master&&(e.doChain(t,e,i),e.log(`${i.key} -> ${t}`))}),this.append=this.add,this.do=this.addToChain}log(t){this.log_txt=this.log_txt.concat(" | "+t)}doChain(t,e,i=this){if(!this.actionChain)return null;for(let n of this.actionChain)n(t,e,i)}unchain(){return this.actionChain=[],this.addToChain((t,e,i=this)=>{this.master&&(e.doChain(t,e,i),e.log(`${i.key} -> ${t}`))}),this}addToChain(){return this.actionChain||(this.actionChain=[]),n(arguments,t=>{this.actionChain.push(t)}),this}get logs(){return this.log_txt}proc_value(t){if(this.loopingValue)return[this.loopBoundVal(t),!0];let e=this.rangeBoundVal(t);return[e,e==t]}set value(t){let e=this.proc_value(t);this.actualValue=e[0],e[1]&&this.doChain(this.actualValue,this.master)}get value(){return this.actualValue}get master(){return null==this.parent||null==this.parent.parent?this.parent:this.parent.master}get html(){return{class:(t,e=!1)=>(e&&this.element.removeClass(),this.element.addClass(t),this),more:"more cool api capabilities coming soon. Usage: pragma.html.class('lucid').......pragmatize()"}}pragmatize(e){return e instanceof a&&(e=e.element),t(e||document.body).append(this.element),this.isAppended=!0,this}chain(t){return this.actionChain=this.actionChain.concat(t.actionChain),this}with(t,e){return this.contain(m(e).as(t))}from(e,i=!1){return e=t(e),this.element.remove(),this.element=null,!i&&e.attr("id")&&(this.key=e.attr("id")),this.isAppended=!0,this.as(e,!0)}as(e,i=!1){let n=t(e);return i||n.attr("id",this.key),this.element&&this.element.replaceWith(n),this.element=n,this}compose(e=!1,i="div"){return this.as(t(document.createElement(i)))}addSilently(){return n(arguments,t=>{super.add(t)}),this}add(){return n(arguments,t=>{super.add(t),t.isAppended||this.element.append(t.element)}),this}prepend(){return n(arguments,t=>{super.add(t),t.isAppended||this.element.prepend(t.element)}),this}buildInside(t){let e=m(t.key+"-composer",null,[t]);this.buildAndAdd(e),this.host(e)}containsKey(t){return this.childMap.has(t)}contain(){return n(arguments,t=>{this.add(t)}),this}setTippy(t,i){return i||(i={allowHTML:i,interactive:!0,theme:"pragma",arrow:!1}),this.tippy=e(this.element[0],{content:t,...i}),this}host(){const t=this.key+"-host";let e;return n(arguments,i=>{this.tippy?(e=this.find(t),e.contain(i),this.tippy.destroy()):(e=m(t).contain(i),this.contain(e)),e.element.addClass("pragma-tippy"),this.setTippy(e.element[0])}),this}buildAndAdd(t){let e=new C(t,this);this.add(e)}buildArray(t){for(let e of t)this.buildAndAdd(e)}illustrate(e){return this.icon||(this.icon=t(document.createElement("div")),this.icon.addClass("pragma-icon"),this.icon.appendTo(this.element)),this.icon.html(e),this}build(e){this.compose(!0),e.icon&&this.illustrate(e.icon),e.elements&&this.buildArray(e.elements),e.hover_element&&this.buildInside(e.hover_element),e.value&&(this.value=e.value),e.set&&this.addToChain((t,i,n)=>e.set(t,i,n)),null!=e.key&&(this.key=e.key,this.element.attr("id",this.key)),e.type&&(this.type=e.type,this.element.addClass(`pragma-${e.type}`)),e.click&&(this.onclick=()=>{e.click(this.master,this)},this.element.addClass("pragma-clickable"),this.setup_listeners({click:this.onclick})),e.mouseover&&(this.element.addClass("pragma-hoverable"),this.setup_listeners({onmouseover:()=>{e.mouseover(this.master)}})),e.mouseout&&this.setup_listeners({mouseout:()=>{e.mouseover(this.master)}}),e.element&&(this.element=t(e.element)),e.element_template&&e.variants&&e.variants.forEach((t,i)=>{let n=e.element_template(t,i);n.type="option",this.buildAndAdd(n)})}dismantle(){return this.children=[],this}leaveUsKidsAlone(){return this.dismantle()}proc_bind_cb(t){return t||(this.onclick?()=>{this.onclick(this.master)}:t=>{t.value+=1})}bind(t,e,n){return e=this.proc_bind_cb(e),i.bind(t,()=>e(this),n),this}get allChildren(){if(!this.hasKids)return null;let t=this.children;for(let e of t){let i=e.allChildren;i&&(t=t.concat(i))}return t}get depthKey(){return this.parent?this.parent.depthKey+"<~<"+this.key:this.key}shapePrefix(t=""){let e=`${t}| ${this.type} - ${this.key} \n`;if(this.hasKids){t+="| ";for(let i of this.children)e+=i.shapePrefix(t)}return e}setRange(t,e){return this.rangeAry=[t,e],this}loopBoundVal(t){if(!this.loopingValue)return t;let e=this.loopingValue;return(t=t>e[1]?e[0]:t)<e[0]?e[1]:t}setLoop(t,e){return this.loopingValue=[t||(this.range?this.range[0]:0),e||(this.range?this.range[1]:69)],this}rangeBoundVal(t){return this.range?Math.max(this.range[0],Math.min(t,this.range[1])):t}get range(){return this.rangeAry}get shape(){return this.shapePrefix()}descOf(t){return!!t.find(this.key)}setup_listeners(t){Object.entries(t).forEach(([t,e])=>{this.element.on(t,t=>e(t,this))})}}function x(e,i){e.find("path").each((e,n)=>{const s=(n=t(n)).attr("fill");"none"!=s&&"transparent"!=s&&n.attr("fill",i)})}function _(t,e){if(typeof t==typeof e!=="object")return e;for(const[i,n]of Object.entries(e))t[i]=n;return t}class A{constructor(t,e=null){this.db=t,this.default=e||{fill:"black",width:"18px",height:"18px",viewBox:"0 0 24 24"}}set default(t){this.defaultOptions=_(this.default,t)}get default(){return this.defaultOptions}optionify(t){return"object"==typeof t?_(this.default,t):this.default}grab(e,i){i=this.optionify(i);let n=function(e,i){if(!i)return s(`Icon Database is not defined, while trying to grab [${e}] from [${i}].`,"fixes",["Typo in the file name?","Did you forget to initialize IconBuilder with an icon database?"]);const n=i[e];return n?t(n):s(`Could not find ${e}`)}(e,this.db);for(const[t,e]of Object.entries(i))"fill"==t&&x(n,e),n.attr(t,e);return n}build(t,e){return e&&e.skip||dontEnvelope.includes(t)?this.db[t]:this.buildIcon(this.db[t],e)}buildIcon(t,e={}){return`\n      <svg xmlns="http://www.w3.org/2000/svg" viewBox="${e.viewBox||this.default.viewBox}" fill="${e.fill||this.default.fill}" \n      width="${e.width||this.default.width}" height="${e.height||this.default.height}" ${e.extra}>\n        ${t}\n      </svg>\n      `}}export{w as Bridge,h as Button,C as Comp,m as Compose,A as IconBuilder,l as Monitor,a as Pragma,c as Select,d as Slider,f as Value,o as Variants,y as at,k as contain,b as host,r as parse,v as pragmatize};
//# sourceMappingURL=index.esm.js.map
